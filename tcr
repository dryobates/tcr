#! /bin/sh
# https://github.com/dryobates/tcr

set -euo pipefail

expected=${1:-}

main() {
    error_when_not_git_repository
    error_when_no_initial_commit

    case $expected in
        red)
            $TCR_TEST_COMMAND && exit 1 || exit 0
            ;;
        green)
            $TCR_TEST_COMMAND
            ;;
        *)
            error "Usage: tcr {red,green} [msg]"
            ;;
    esac
}

error_when_not_git_repository() {
    test -d .git || error "Run from git repository!"
}

error_when_no_initial_commit() {
    git show > /dev/null || error "At least initial commit is needed"
}

error() {
    echo $1
    exit 1
}

main
